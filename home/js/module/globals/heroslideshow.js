define(["jquery","modernizr","module/globals/tracking"],function(t){"use strict";function i(i,n){if(this.options=i,this.container=n,this.index=0,this.id=this.container.attr("id"),this.mv=!1,this.tracking=e.tracking||!1,this.id||(this.id=this.container.data("id")),this.imgs=this.container.find("img,.hero-video,.hero-img").not(".no-hero-slideshow").not(this.container.find(".hero-img img")).not(this.container.find(".hero-video img")).fadeTo(0,0).stop(!0,!0).data("slideshow-trigger",!1),this.length=this.imgs.size(),r)for(var h in a)a.hasOwnProperty(h)&&this.imgs.filter("img").css(a[h],"translateZ(0)");this.imgs.eq(this.index).is(".hero-video")?this.container.addClass("slide-video"):this.container.removeClass("slide-video"),t(this.imgs.get().reverse()).each(t.proxy(function(i,s){var e=t(s),n={position:"absolute",zIndex:100+i,top:0,left:0,visibility:"visible"};if(e.hasClass("horizontal")?(n.top="50%",n.transform=r?"translate3d(0,-50%,0)":"translateY(-50%)"):e.hasClass("vertical")&&(n.left="50%",n.transform=r?"translate3d(-50%,0,0)":"translateX(-50%)"),n.transform)for(var i in a)a.hasOwnProperty(i)&&(n[a[i]]=n.transform);e.css(n)},this));var d=t([]);this.nav={prev:t('<div class="slideshow-prev"><i class="icon-angle-left"></i></div>'),next:t('<div class="slideshow-next"><i class="icon-angle-right"></i></div>'),caption:this.container.find(".caption"),overlay:this.container.find(".hero-caption-overlay"),overlayToggle:this.container.find(".toggle-caption"),index:d,dots:d,fullscreen:d,download:d};var l=t('[data-for="detail-hero-image"]');l.size()&&(this.nav.index=l.find(".slideshow-slide span"),this.nav.dotsc=l.find(".slideshow-paging"),this.nav.fullscreen=l.find(".slideshow").not(".download"),this.nav.download=l.find(".slideshow.download")),this.length>1&&(null!==this.options.arrowsContainer?t(this.options.arrowsContainer).first().append(this.nav.prev,this.nav.next):this.container.append(this.nav.prev,this.nav.next),this.nav.prev.off().on("click",t.proxy(function(t){t.preventDefault(),this.mv||(this.tracking&&this.tracking.trackEvent("Hero Arrow","left",e.location.pathname),this.prev())},this)),this.nav.next.off().on("click",t.proxy(function(t){t.preventDefault(),this.mv||(this.tracking&&this.tracking.trackEvent("Hero Arrow","right",e.location.pathname),this.next())},this)),this.nav.dotsc.off("click").on("click",".nav",t.proxy(function(i){i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation(),this.show(t(i.currentTarget).parent().find(".nav").index(i.currentTarget))},this))),this.nav.fullscreen.attr("href","").off().on("click",t.proxy(function(t){if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!this.nav.fullscreen.parent().hasClass("disabled")&&e.slideshow&&e.slideshow.length>0){for(var i=0;i<e.heroSlideshow.length;i++)e.heroSlideshow[i].pauseVideos(),o&&e.heroSlideshow[i].resetVideos();e.slideshow[0].open(this.index)}},this)),this.length>1&&(o&&s.call(this),this.options.showArrows?(this.nav.prev.add(this.nav.next).stop(!0).fadeTo(i.animDuration,1),o?this.nav.prev.add(this.nav.next).find("i").stop(!0).fadeTo(i.animDuration,1):this.nav.prev.add(this.nav.next).on("mouseenter",function(){t(this).find("i").stop(!0).fadeTo(i.animDuration,1)}).on("mouseleave",function(){t(this).find("i").stop(!0).fadeTo(i.animDuration,.5)})):this.nav.prev.add(this.nav.next).show().find("i").remove()),"IMG"!==this.imgs.eq(this.index).prop("tagName")&&this.show(this.index)}function s(i){i||(i=this.container);var s={x:0,y:0},e={},n=!1,o=!1,h=function(t){if(n)return!0;var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];s={x:i.pageX,y:i.pageY},this.mv=!1},d=function(t){if(!n&&!o){var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0];if(!this.mv)if(i.pageX<s.x-10||i.pageX>s.x+10)this.mv=!0,this.imgs.find("iframe").css("pointer-events","none"),e.current=this.imgs.eq(this.index).css("z-index",1),e.prev=this.imgs.eq(this.index-1<0?this.imgs.size()-1:this.index-1).css("left",-e.current.width()+"px"),e.next=this.imgs.eq(this.index+1>this.imgs.size()-1?0:this.index+1).css("left",e.current.width()+"px"),e.same=e.prev.is(e.next),e.dir=1,e.all=e.current.add(e.prev).add(e.next),e.prev.add(e.next).css({position:"absolute",top:0,width:e.current.width()+"px",height:e.current.height()+"px",zIndex:0}).show().fadeTo(0,1);else if(i.pageY<s.y-5||i.pageY>s.y+5)return void(o=!0);if(this.mv){t.preventDefault();var h=i.pageX-s.x;e.same&&(h>0?2!=e.dir&&(e.dir=2,e.prev.css("left",-e.current.width()+"px")):1!=e.dir&&(e.dir=1,e.next.css("left",e.current.width()+"px")));for(var d in a)a.hasOwnProperty(d)&&e.all.css(a[d],r?"translate3d("+h+"px,0,0)":"translate("+h+"px,0)")}}},l=function(i){if(o=!1,this.imgs.find("iframe").css("pointer-events","auto"),n||!this.mv)return!0;var h=i.originalEvent.touches[0]||i.originalEvent.changedTouches[0],d=h.pageX-s.x,l=Math.abs(d),c=e.current.width(),p=e.current,f=0,v=1.5*this.options.animDuration*l/c;Math.abs(d)>=c/3&&(p=d>0?e.prev:e.next,f=d>0?c:-c,v=1.5*this.options.animDuration*(c-l)/c),n=!0,t({a:d}).animate({a:f},{duration:v,step:function(t){for(var i in a)a.hasOwnProperty(i)&&e.all.css(a[i],r?"translate3d("+t+"px,0,0)":"translate("+t+"px,0)")},complete:t.proxy(function(){e.all.not(p.css("display","block")).hide();for(var i in a)a.hasOwnProperty(i)&&e.all.css(a[i],r?"translateZ(0)":"");e.all.css({position:"",width:"",height:"",zIndex:"",left:""}),this.index=this.imgs.index(p),this.show(this.index),setTimeout(t.proxy(function(){this.mv=!1,n=!1},this),0)},this)})};i.on("touchstart",t.proxy(h,this)).on("touchmove",t.proxy(d,this)).on("touchend touchcancel",t.proxy(l,this))}var e=window,n=t(window),o=e.Modernizr?e.Modernizr.touchevents:"ontouchstart"in e,a={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},r=function(){var t,i=document.createElement("p"),s={};document.body.insertBefore(i,null);for(var n in a)void 0!==i.style[n]&&(s[n]=a[n],i.style[n]="translate3d(1px,1px,1px)",t=e.getComputedStyle(i).getPropertyValue(a[n]));return document.body.removeChild(i),a=s,void 0!==t&&t.length>0&&"none"!==t}(),h={animDuration:250,animEffect:"crossfade",showArrows:!0,arrowsContainer:null,onShow:null},d=function(t){return decodeURIComponent((t+"").replace(/%(?![\da-f]{2})/gi,function(){return"%25"}))};return e.heroSlideshow=[],i.prototype.show=function(i){if(i!=this.index){var s=this.imgs.eq(this.index),a=this.imgs.eq(i);if(!s.size()||!a.size())return;s.css({"z-index":101+this.length}),a.css({"z-index":102+this.length}),"crossfade"==this.options.animEffect?(s.fadeTo(0,1).stop(!0,!0).fadeTo(this.options.animDuration,0),a.fadeTo(0,0).stop(!0,!0).fadeTo(this.options.animDuration,1,function(){s.hide()})):"dissolve"==this.options.animEffect?(e.slideI1=s,e.slideI2=a,s.stop(!0,!0).fadeTo(0,1),a.stop(!0,!0).fadeTo(0,0).fadeTo(this.options.animDuration,1,function(){s.hide()})):(s.stop(!0,!0).hide(),a.stop(!0,!0).show(),a.css({position:"",display:"block",left:"",top:""})),this.index=i,this.pauseVideos(),o&&this.resetVideos()}else"crossfade"==this.options.animEffect||"dissolve"==this.options.animEffect?this.imgs.eq(i).fadeTo(this.options.animDuration,1):this.imgs.eq(i).stop(!0,!0).show();for(var r=0;r<e.heroSlideshow.length;r++)e.heroSlideshow[r].id==this.id&&e.heroSlideshow[r].index!=this.index&&e.heroSlideshow[r].show(this.index);this.nav.index.text(this.index+1),this.nav.dotsc.each(t.proxy(function(i,s){t(s).find(".nav").removeClass("active").eq(this.index).addClass("active")},this));var h=this.imgs.eq(this.index);h.is(".hero-video")?this.container.addClass("slide-video"):this.container.removeClass("slide-video"),this.nav.download.attr("href",h.attr("data-slideshow")||h.attr("src"));var l=!1;if(this.nav.caption.removeData("settings"),""!==h.attr("data-settings"))try{l=JSON.parse(d(h.attr("data-settings"))),this.nav.caption.removeClass("left").removeClass("right").addClass(l.pos?l.pos:""),this.nav.caption.data("settings",l)}catch(t){}var c;if(""!==h.attr("data-url"))if(c=t(document.createElement("a")),c.html(t(document.createElement("span")).append(h.attr("data-caption"))),c.attr("href",h.attr("data-url")),c.attr("target",h.attr("data-target")),this.nav.caption.html(c),h.attr("data-overlay")){var p=d(h.attr("data-overlay"));p&&(this.nav.overlay.html(p),this.nav.overlay.show(),this.nav.overlayToggle.css("visibility","visible"))}else this.nav.overlay.hide(),this.nav.overlayToggle.css("visibility","hidden");else c=t('<span class="homepage-caption"></span>'),""!==h.attr("data-caption")?this.nav.caption.html(c.append(t(document.createElement("span")).append(h.attr("data-caption")))):this.nav.caption.html("");l&&c.size()&&l.class&&c.addClass(l.class),"1"===h.attr("data-fs-disabled")?this.nav.fullscreen.parent().addClass("disabled"):this.nav.fullscreen.parent().removeClass("disabled"),this.options.onShow&&t.isFunction(this.options.onShow)&&this.options.onShow.call(this),n.trigger("heroSlideshowChange",[this])},i.prototype.prev=function(){var t=this.index-1;this.imgs&&this.imgs.length&&(t<0&&(t=this.imgs.size()-1),this.show(t))},i.prototype.next=function(){var t=this.index+1;this.imgs&&this.imgs.length&&(t>this.imgs.size()-1&&(t=0),this.show(t))},i.prototype.pauseVideos=function(){this.container.find("iframe").each(function(){this.contentWindow.postMessage('{"event":"command","func":"pauseVideo"}',"*"),this.contentWindow.postMessage('{"method":"pause"}',"*")})},i.prototype.resetVideos=function(){this.container.find("iframe").each(function(){var i=t(this).parent().html();t(this).parent().html(i)})},t.fn.heroSlideshow=function(s){return t(this).each(function(){if(!t(this).data("heroSlideshow")&&t(this).find("img,.hero-video,.hero-img").size()>0){var n=new i(t.extend(h,s),t(this));e.heroSlideshow.push(n),t(this).data("heroSlideshow",n),n.show(0)}}),this},{start:function(){t("div.hero-slideshow").heroSlideshow()}}});