define(["jquery","module/globals/navigation","module/globals/recaptcha","module/globals/util","selectr","slideshow","effects","module/globals/tracking"],function(e,n,t,i,a,o){function r(){s(),l(),d(),f(),u(),p(),m(),v(),h(),o.start()}function s(){var n=g.find(".fw-header");n.size()&&require(["adjusttext"],function(){n.each(function(){var n=e(this);n.data("init")||(n.find(".fw-img-title-inner").adjustText({dimension:"width",viewport:{width:1024},minRelativeFontSize:.4,noOverflowAdjust:!0}),n.data("init",!0))})})}function l(){var e=g.find(".slot-carousel-wrapper");e.size()&&require(["module/homepage/smoothscroll"],function(){c(e)})}function c(n){n.each(function(){var n=e(this),t=n.find(".slot-carousel").first();if(t.size()&&!t.data("carousel")){t.data("carousel",!0),t.find(".item").show();var i=n.parent().find(".slot-carousel-paging").first(),a=n.parent().find(".slot-carousel-paging-dots").first(),o=n.parent().find(".slot-carousel-title").find(".slot-carousel-title-inner"),r=n.parent().find(".slot-carousel-caption").find(".slot-carousel-caption-inner"),s=i.find("li"),l=a.find("li"),c=s.size()-1,d=n.find(".slideshow-prev"),f=n.find(".slideshow-next"),u=[s,l,o,r],p=t.smoothScroll({index:0,onBeforeSeek:function(){e.each(u,function(){this.removeClass("active").eq(p.options.index).addClass("active")})}}).data("smoothScroll");t.find(".slot-carousel-caption-toggle").on("click",function(n){n.preventDefault();var i=e(this);i.toggleClass("open"),i.hasClass("open")?t.find(".slot-carousel-img-caption").show():t.find(".slot-carousel-img-caption").hide()}).trigger("click"),t.on("click",".slot-carousel-img-caption-close",function(e){e.preventDefault(),t.find(".slot-carousel-caption-toggle").trigger("click")}),i.on("click","li",function(){var e=s.index(this);p.goTo(e)}),a.on("click","li",function(){var e=l.index(this);p.goTo(e)}),d.on("click",function(){p.options.index>0?p.prev():p.goTo(c)}),f.on("click",function(){p.options.index<c?p.next():p.goTo(0)})}})}function d(){var n=g.find(".slot-slots-container");if(n.size()){var t=e("html, body"),i=0;n.each(function(){var n=e(this),a=n.find(".slots-container-content-wrapper").first(),o=a.find(".slots-container-content").first(),r=a.find(".slots-container-content-gradient"),s=n.find(".slots-container-more > a"),l=a.data("height"),c=function(){w.trigger("scroll")},d=function(){a.add(a.parent()).add(o).css("overflow","visible"),w.trigger("resize"),a.css({height:"auto"})},f=function(){a.add(a.parent()).add(o).css("overflow","hidden"),w.trigger("resize")},u=function(s){s.preventDefault(),n.toggleClass("content_collapsed"),n.find("[data-toggletext]").each(function(){var n=e(this),t=n.text();n.text(n.data("toggletext")).data("toggletext",t)}),o.height("auto");var u=Math.max(l,o.outerHeight(!0));n.hasClass("content_collapsed")?(a.add(a.parent()).add(o).css("overflow","hidden"),r.stop(!0).fadeIn(300),a.stop(!0).animate({height:l},{duration:300,progress:c,complete:f}),i&&t.stop(!0).animate({scrollTop:i},{duration:300})):(i=t.scrollTop(),t.stop(!0),r.stop(!0).fadeOut(300),a.stop(!0).animate({height:u},{duration:300,progress:c,complete:d}))};l||(l=500),n.find(".slots-container-toggle").on("click",u),s.on("click",u)})}}function f(){var n=g.find(".slot-grid-block-layer.scrollable");n.size()&&require(["module/homepage/carousel"],function(){n.each(function(){e(this).data("carousel")||e(this).data("carousel",!0).removeClass("nojs").carousel({},{slideWidthContent:1,time:300,enableForceStop:1})})})}function u(){var n=g.find(".slot-component-newsletter");if(n.size()){var t=i.emailRegex,a=n.find("form").first(),o=a.find(".slot-component-newsletter-email"),r=a.find(".slot-component-newsletter-submit"),s=n.find(".slot-component-newsletter-response").hide(),l=!1;a.off("submit").on("submit",function(n){if(n.preventDefault(),!l){var i=a.find("[name=email]").val();t.test(i)?(l=!0,a.hide(),s.show().text("Submitting..."),e.ajax({url:a.attr("action"),type:"post",data:a.serialize(),dataType:"json"}).done(function(e){200==e.code?(a.remove(),s.show().text(e.response)):alert(e.response)}).always(function(){l=!1})):(alert("Please enter a valid email address."),o.focus())}}),r.on("click",function(e){e.preventDefault(),l||a.submit()})}}function p(){function n(n,t){var i=!1;if(r(n),t||(n.find("[name=first_name]").val(e.trim(n.find("[name=first_name]").val())),n.find("[name=last_name]").val(e.trim(n.find("[name=last_name]").val())),n.find("[name=organization]").val(e.trim(n.find("[name=organization]").val())),n.find("[name=industry]").val(e.trim(n.find("[name=industry]").val())),n.find("[name=email]").val(e.trim(n.find("[name=email]").val()))),n.find("[name=email]").val()){var a=c.exec(n.find("[name=email]").val());a?n.find("[name=email]").val(a[0]):(t||alert("Please input a valid email address."),o(n,"email","Invalid email address."),i=!0)}else o(n,"email","Required."),i=!0;return i&&o(n,"error","Please check the form for errors."),n.find("[name=first_name]").val()||(o(n,"first_name","Required"),i=!0),n.find("[name=last_name]").val()||(o(n,"last_name","Required"),i=!0),n.find("[name=organization]").val()||(o(n,"organization","Required"),i=!0),n.find("[name=industry]").val()||(o(n,"industry","Required"),i=!0),!i}function o(n,t,i){var t=n.find('[name="'+t+'"]'),a=n.find('label[for="'+t.attr("id")+'"]'),o=t.parent();t.addClass("error"),a.size()&&a.append(e('<span class="error"></span>').text(i)),o.hasClass("selectr-container")&&(o.addClass("error"),o.find(".selectr-label").append(e('<span class="error"></span>').text(i)))}function r(e){e.find("span.error").remove(),e.find(".error").removeClass("error")}function s(n){return n=e(n),n.hasClass("label")?'<span class="label">'+n.text()+"</span>"+(n.hasClass("required")?' <span class="required">*</span>':""):n.text()}var l=g.find(".slot-component-download-form");if(l.size()){var c=i.emailRegex;t.render(),l.each(function(){var o=e(this);if(o.data("init"))return!0;var r,l,c=e(this).find("form").first(),d=c.prop("id"),f=!1,u=o.find(".form-inline-status"),p=parseInt(c.data("resId"),16),m=c.data("resTitle");window["compCaptchaCB"+d]=function(){tracking.trackEvent("Download: Submit Inline",p+" "+m,location.pathname+location.search+location.hash),e.ajax({url:c.attr("action"),method:"post",data:c.serialize(),dataType:"json"}).done(function(n){if(n.error)u.text("Error: "+n.error);else{tracking.trackEvent("Download: Submit Inline Success",p+" "+m,location.pathname+location.search+location.hash),window.pardotCallback=function(){u.text(n.msg?n.msg:"Success!"),n.url&&setTimeout(function(){window.location.href=n.url},50)};var t={url:location.href,doc_id:parseInt(p,16),doc_title:m,doc_url:n.url,doc_lang:c.find("select[name=lang]").val()||"",email:c.find("input[name=email]").val(),first_name:c.find("input[name=first_name]").val(),last_name:c.find("input[name=last_name]").val(),organization:c.find("input[name=organization]").val(),industry:c.find("select[name=industry]").val()||"",optin:c.find("input[name=optin]").is(":checked")?1:0};e.ajax({url:"https://www2.gensler.com/l/484051/2020-03-03/qt43f",data:t,dataType:"jsonp"})}}).fail(function(){u.text("").hide(),t.reset(c.find(".g-recaptcha").data("recaptchaId")),c.css("visibility",""),alert("An error has occurred. Please try again later")}).always(function(){clearInterval(r),f=!1})},c.on("submit",function(e){if(e.preventDefault(),!f){if(f=!0,c.find("[name=uri]").val(window.location.pathname),!n(c))return f=!1,void c.on("input.validation keyup.validation click.validation","input, select",function(){n(c,!0)&&c.off(".validation")});c.css("visibility","hidden"),u.show().text("Submitting"),l=0,r=setInterval(function(){++l>4&&(l=0),u.text("Submitting"+Array(l).join("."))},250),t.execute(c.find(".g-recaptcha").data("recaptchaId"))}}),c.find("select[name=lang]").each(function(){for(var n=i.getBrowserLanguages(),t=e(this),a=0;a<n.length;a++)if(t.find('option[value="'+n[a]+'"]').size()){t.val(n[a]);break}}),o.find("select").each(function(){new a(this,{searchable:!1,renderOption:s,renderSelection:s})}),o.find("input[type=text]").off().on("click input keyup",function(){o.find("label[for="+this.id+"]")[e(this).val().length>0?"hide":"show"]()}).trigger("input"),o.find(".submit").attr("disabled",!1),o.find(".submit").attr("onclick",!1),o.data("init",!0)})}}function m(){function t(e,n){var t=Date.now();return function(){t+n-Date.now()<0&&(e(),t=Date.now())}}function i(e,n){for(var t,i=0,a=n.length-1;a-i>1;)t=Math.floor((i+a)/2),n[t]<e?i=t:a=t;return e-n[i]<=n[a]-e?n[i]:n[a]}var a=g.find(".slot-parallax-video-wp");a.size()&&a.each(function(){var a=e(this);if(!a.data("init")){var o=a.find("video").get(0);if(o){if(e(o).prop("loop")){var r=a.parent().find(".player-control-btn"),s=!1,l=function(){if(!s){var e=a.offset().top,t=e+a.outerHeight(),i=n.getScrollY();i+n.getViewportHeight()>e&&i<t?(o.play(),r.addClass("pause")):(o.pause(),r.removeClass("pause"))}};r.on("click",function(){r.hasClass("pause")?(o.pause(),r.removeClass("pause")):(o.play(),r.addClass("pause")),s=!0}),w.on("scroll",t(l,50)).on("resize",t(l,80)),l()}else{var c=e(o).data("kf");if(c){c=c.split(",");for(var d=0;d<c.length;d++)c[d]=parseFloat(c[d])}var f=function(e){return c.length?i(e,c):e},l=function(){var e=n.getScrollY(),t=a.offset().top,i=0;e>=t&&(i=e/(a.height()+t-n.winH))>1&&(i=1),o.currentTime=f(o.duration*i)};w.on("scroll",l).on("resize",l)}a.data("init",!0)}}})}function v(){var n=g.find(".slot-sticky-bg");if(n.size()){n.fadeTo(0,0).css({visibility:"hidden"}),n.each(function(n){e(this).find("> .slot-parallax-bg").css({zIndex:100+n})});var t=!1;e(window).on("scroll",function(){var i=!1;n.each(function(n){e.inviewport(this.parentNode,{threshold:0,container:window})&&(i=n)}),!1!==i&&t===i||!1!==t&&n.eq(t).stop(!0).fadeTo(250,0,function(){e(this).css({visibility:"hidden"})}),!1!==i&&t!==i&&n.eq(i).stop(!0).css({visibility:"visible"}).fadeTo(250,1),t=i})}}function h(){var n,t,i=e(".contents-container"),a=i.find(".side-nav .nav"),o=!!a.size(),r=!1;if(o){a.each(function(){var n=e(this).data("for");n="hero"==n?i.find(".container-fluid.main-container,.hero-parallax-wrapper").first():"footer"==n?i.find(".design-forecast-footer"):"archive"==n?i.find(".design-forecast-archive"):i.find("."+n),n.size()&&e(this).data("elm",n)}),a.on("click",function(n){n.preventDefault();var t=e(this).data("elm");if(t){var i=t.first().offset();i&&i.top&&(r=!0,a.removeClass("active"),e(this).addClass("active"),e("html, body").animate({scrollTop:i.top-46},325,"easeOutQuart",function(){r=!1}))}});var s=function(){n=w.innerHeight(),t=[],a.each(function(){var n,i=e(this).data("elm");i&&(n=i.offset())&&n.top&&t.push(n.top)}),t.push(e(document).height())},l=function(){if(o&&!r){var e,i,s=w.scrollTop(),l=s+n,c=0,d=0,f=0;for(i=0;i<t.length-1;i++)if(l>t[i]&&s<t[i+1]){if(d=t[i+1]-t[i],e=d,t[i]<s&&(e-=s-t[i]),t[i+1]>l&&(e-=t[i+1]-l),d==e){c=i;break}e>f&&(f=e,c=i)}a.removeClass("active"),a.eq(c).addClass("active")}};s(),e(window).on("resize.sideNav",s).on("scroll.sideNav",l)}}var g,w=e(window);e(function(){g=e(".contents-container"),g.size()||(g=e(document)),w.on("tabchange",r),r()})});